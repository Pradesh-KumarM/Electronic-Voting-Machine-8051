ORG 0000H
RS EQU P1.0
RW EQU P1.1
E EQU P1.2
ROW EQU P0
COL EQU P3
STARTELECTION:ACALL INITIALIZEDB
MOV R0,#36H
L7:MOV @R0,#00H
START:ACALL INITIALIZELCD
MOV DPTR,#ENTERID
MOV B,#8
ACALL DISPLAY
MOV P2,#0C0H
ACALL COMMAND
ACALL GETID
MOV R3,30H
MOV R2,31H
MOV R1,32H
MOV R0,33H
ACALL GETADDRESS
MOV 34H,A
MOV 35H,B
ACALL CHECKVALIDITY
MOV A,20H
INVALID1:MOV P2,#01H
ACALL COMMAND
MOV DPTR,#INVALIDID
MOV B,#11
ACALL DISPLAY
ACALL GETNUM
ACALL DELAY1S
SJMP START
MOV P2,#01H
ACALL COMMAND
MOV DPTR,#CASTVOTE
MOV B,#14
ACALL DISPLAY
ACALL GETNUM
MOV P2,#0C0H
ACALL COMMAND
MOV P2,A
ACALL DATA1
ACALL DELAY1S
ACALL INCVOTES
MOV A,34H
MOV B,35H
ACALL SETADDRESS
MOV P2,#01H
ACALL COMMAND
MOV DPTR,#VOTECOUNTED1
MOV B,#12
ACALL DISPLAY
MOV P2,#0C4H
ACALL COMMAND
MOV DPTR,#VOTECOUNTED2
MOV B,#7
ACALL DISPLAY
ACALL GETNUM
ACALL DELAY1S
SJMP START
FUNCTIONS: LJMP FINISH
MOV R5,#00H
SJMP NEXT
FOUNDCOLUMN:RET
MOV B,#00H
MOV ROW,#00001110B
MOV A,COL
MOV ROW,#00001101B
MOV A,COL
MOV ROW,#00001011B
MOV A,COL
MOV ROW,#00000111B
MOV A,COL
FOUNDROW:RET
MOV R1,#36
HERE1:MOV R0,#255
RET
MOV R2,#100; OLD VAL=157
L3:MOV R1,#255
L2:MOV R0,#10
RET
MOV P2,#01H
ACALL COMMAND
MOV P2,#38H
ACALL COMMAND
MOV P2,#0EH
ACALL COMMAND
RET
MOV R3,#2
HERE3:MOV R4,#255
RET
CLR RW
CLR RS
SETB E
ACALL DELAYFORLCD
CLR E
ACALL DELAYFORLCD
RET
CLR RW
SETB RS
SETB E
ACALL DELAYFORLCD
CLR E
ACALL DELAYFORLCD
RET
CLR A
MOVC A,@A+DPTR
MOV P2,A
ACALL DATA1
RET
MOV R4,#40H
MOV B,#0CH			;ADDRESS=R2(0CH)+R1+40H +QUOTIENT OF {R2(04H)+R0+R1(02H)}/8
MOV A,R2			;ADDRESS WILL BE STORED IN A
MOV R4,A
MOV A,R2
MOV B,#04H
MOV R5,A
MOV A,R1
MOV B,#02H
MOV B,#08H
RET
MOV COL,#0FFH
NOTPRESSED:MOV ROW,#00H
MOV A,COL
SJMP NOTPRESSED
ACALL DELAY20MS
MOV A,COL
SJMP NOTPRESSED
ACALL GETROW
ACALL GETCOLUMN
MOV A,#04
MOV DPH,#03H
MOV DPL,A
CLR A
MOVC A,@A+DPTR
RET
MOV R7,#30H
MOV R6,#04H
NEXTNUM:ACALL GETNUM
ACALL SHOWRESULTS
NOTSTARANDNOTHASH:MOV P2,A
ACALL DATA1
MOV B,R7
MOV R0,B
MOV @R0,A
ACALL DELAY1S
RET
INITIALIZEDB:
MOV R0,#40H
ITER:MOV @R0,#00H
RET
MOV A,#00000001B
RET
MOV R0,A
ACALL GETMASK
MOV 20H,#0AH
SJMP OVER1
INVALID:MOV 20H,#0BH
OVER1:RET
MOV R0,A
ACALL GETMASK
MOV @R0,A
RET
MOV B,#2H		;WILL BE INCREASED BY 1,THE VOTE COUNT IS STORED IN 36H,37H FOR A ,38H AND 39H FOR B 3AH AND 3BH FOR C
MOV R0,A
MOV @R0,#00H
SJMP OVER2
NOT99:MOV B,#10H
MOV A,@R0
MOV R1,B
MOV A,#7H
MOV @R0,A
SJMP OVER2
OVER2:RET
MOV R0,A
MOV A,@R0
MOV P2,A
ACALL DATA1
MOV A,@R0
MOV B,#10H
MOV P2,A
ACALL DATA1
MOV A,B
MOV P2,A
ACALL DATA1
RET
MOV P2,#01H
ACALL COMMAND
MOV B,#2H
MOV DPTR,#LA
ACALL DISPLAY
MOV A,#36H
ACALL PRINTNUMBER
MOV DPTR,#SPACE
MOV B,#5H
ACALL DISPLAY
MOV B,#2H
MOV DPTR,#LB
ACALL DISPLAY
MOV A,#38H
ACALL PRINTNUMBER
MOV P2,#0C0H
ACALL COMMAND
MOV B,#2H
MOV DPTR,#LC
ACALL DISPLAY
MOV A,#3AH
ACALL PRINTNUMBER
MOV DPTR,#SPACE
MOV B,#5H
ACALL DISPLAY
MOV B,#2H
MOV DPTR,#LD
ACALL DISPLAY
MOV A,#3CH
ACALL PRINTNUMBER
ACALL DELAY1S
ACALL GETNUM
ACALL DELAY1S
RET
ORG 0300H
DB "A321B654C987D#0*"
ENTERID:DB "ENTER ID:"
LA:DB "A:"
LB:DB "B:"
LC:DB "C:"
LD:DB "D:"
SPACE:DB "     "
INVALIDID:DB "INAVALID ID"
CASTVOTE:DB "CAST YOUR VOTE"
VOTECOUNTED1:DB "YOUR VOTE IS"
VOTECOUNTED2:DB "COUNTED"
ENDORG 0000H
RS EQU P3.7
RW EQU P3.6
E EQU P3.5
ROW EQU P0
COL EQU P1
STARTELECTION:ACALL INITIALIZEDB
MOV R0,#36H
L7:MOV @R0,#00H
START:ACALL INITIALIZELCD
MOV DPTR,#ENTERID
MOV B,#8
ACALL DISPLAY
MOV P2,#0C0H
ACALL COMMAND
ACALL GETID
MOV R3,30H
MOV R2,31H
MOV R1,32H
MOV R0,33H
ACALL GETADDRESS
MOV 34H,A
MOV 35H,B
ACALL CHECKVALIDITY
MOV A,20H
INVALID1:MOV P2,#01H
ACALL COMMAND
MOV DPTR,#INVALIDID
MOV B,#10
ACALL DISPLAY
ACALL GETNUM
ACALL DELAY1S
SJMP START
MOV P2,#01H
ACALL COMMAND
MOV DPTR,#CASTVOTE
MOV B,#14
ACALL DISPLAY
ACALL GETNUM
MOV P2,#0C0H
ACALL COMMAND
MOV P2,A
ACALL DATA1
ACALL DELAY1S
ACALL INCVOTES
MOV A,34H
MOV B,35H
ACALL SETADDRESS
MOV P2,#01H
ACALL COMMAND
MOV DPTR,#VOTECOUNTED1
MOV B,#12
ACALL DISPLAY
MOV P2,#0C4H
ACALL COMMAND
MOV DPTR,#VOTECOUNTED2
MOV B,#7
ACALL DISPLAY
ACALL GETNUM
ACALL DELAY1S
SJMP START
FUNCTIONS: LJMP FINISH
MOV R5,#00H
SJMP NEXT
FOUNDCOLUMN:RET
MOV B,#00H
MOV ROW,#00001110B
MOV A,COL
MOV ROW,#00001101B
MOV A,COL
MOV ROW,#00001011B
MOV A,COL
MOV ROW,#00000111B
MOV A,COL
FOUNDROW:RET
MOV R1,#36
HERE1:MOV R0,#255
RET
MOV R2,#100; OLD VAL=157
L3:MOV R1,#255
L2:MOV R0,#10
RET
MOV P2,#01H
ACALL COMMAND
MOV P2,#38H
ACALL COMMAND
MOV P2,#0EH
ACALL COMMAND
RET
MOV R3,#2
HERE3:MOV R4,#255
RET
CLR RW
CLR RS
SETB E
ACALL DELAYFORLCD
CLR E
ACALL DELAYFORLCD
RET
CLR RW
SETB RS
SETB E
ACALL DELAYFORLCD
CLR E
ACALL DELAYFORLCD
RET
CLR A
MOVC A,@A+DPTR
MOV P2,A
ACALL DATA1
RET
MOV R4,#40H
MOV B,#0CH			;ADDRESS=R2(0CH)+R1+40H +QUOTIENT OF {R2(04H)+R0+R1(02H)}/8
MOV A,R2			;ADDRESS WILL BE STORED IN A
MOV R4,A
MOV A,R2
MOV B,#04H
MOV R5,A
MOV A,R1
MOV B,#02H
MOV B,#08H
RET
MOV COL,#0FFH
NOTPRESSED:MOV ROW,#00H
MOV A,COL
SJMP NOTPRESSED
ACALL DELAY20MS
MOV A,COL
SJMP NOTPRESSED
ACALL GETROW
ACALL GETCOLUMN
MOV A,#04
MOV DPH,#03H
MOV DPL,A
CLR A
MOVC A,@A+DPTR
RET
MOV R7,#30H
MOV R6,#04H
NEXTNUM:ACALL GETNUM
ACALL SHOWRESULTS
NOTSTARANDNOTHASH:MOV P2,A
ACALL DATA1
MOV B,R7
MOV R0,B
MOV @R0,A
ACALL DELAY1S
RET
INITIALIZEDB:
MOV R0,#40H
ITER:MOV @R0,#00H
RET
MOV A,#00000001B
RET
MOV R0,A
ACALL GETMASK
MOV 20H,#0AH
SJMP OVER1
INVALID:MOV 20H,#0BH
OVER1:RET
MOV R0,A
ACALL GETMASK
MOV @R0,A
RET
MOV B,#2H		;WILL BE INCREASED BY 1,THE VOTE COUNT IS STORED IN 36H,37H FOR A ,38H AND 39H FOR B 3AH AND 3BH FOR C
MOV R0,A
MOV @R0,#00H
SJMP OVER2
NOT99:MOV B,#10H
MOV A,@R0
MOV R1,B
MOV A,#7H
MOV @R0,A
SJMP OVER2
OVER2:RET
MOV R0,A
MOV A,@R0
MOV P2,A
ACALL DATA1
MOV A,@R0
MOV B,#10H
MOV P2,A
ACALL DATA1
MOV A,B
MOV P2,A
ACALL DATA1
RET
MOV P2,#01H
ACALL COMMAND
MOV B,#2H
MOV DPTR,#LA
ACALL DISPLAY
MOV A,#36H
ACALL PRINTNUMBER
MOV DPTR,#SPACE
MOV B,#5H
ACALL DISPLAY
MOV B,#2H
MOV DPTR,#LB
ACALL DISPLAY
MOV A,#38H
ACALL PRINTNUMBER
MOV P2,#0C0H
ACALL COMMAND
MOV B,#2H
MOV DPTR,#LC
ACALL DISPLAY
MOV A,#3AH
ACALL PRINTNUMBER
MOV DPTR,#SPACE
MOV B,#5H
ACALL DISPLAY
MOV B,#2H
MOV DPTR,#LD
ACALL DISPLAY
MOV A,#3CH
ACALL PRINTNUMBER
ACALL DELAY1S
ACALL GETNUM
ACALL DELAY1S
RET
ORG 0300H
DB "A321B654C987D#0*"
ENTERID:DB "ENTER ID:"
LA:DB "A:"
LB:DB "B:"
LC:DB "C:"
LD:DB "D:"
SPACE:DB "     "
INVALIDID:DB "INVALID ID"
CASTVOTE:DB "CAST YOUR VOTE"
VOTECOUNTED1:DB "YOUR VOTE IS"
VOTECOUNTED2:DB "COUNTED"